<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OrcaX Farm - ë†ì¥</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-lime-50 to-green-100 min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-6 space-y-6">

    <!-- ì”¨ì•— ìƒì  -->
    <div>
      <h2 class="text-2xl font-bold text-center text-green-700 mb-4">ğŸŒ± ì”¨ì•— ìƒì </h2>
      <div class="flex gap-3">
        <button onclick="buySeed('potato')" class="flex-1 bg-green-500 text-white py-2 rounded-xl hover:bg-green-600 transition">ğŸ¥” ì”¨ê°ì êµ¬ë§¤</button>
        <button onclick="buySeed('barley')" class="flex-1 bg-yellow-500 text-white py-2 rounded-xl hover:bg-yellow-600 transition">ğŸŒ¾ ë³´ë¦¬ì”¨ êµ¬ë§¤</button>
      </div>
      <div class="mt-3 text-sm text-gray-600">
        <p id="user-tokens">ë³´ìœ  í† í°: ë¡œë”©ì¤‘...</p>
        <p id="inventory-status">ì”¨ê°ì: -, ë³´ë¦¬ì”¨: -</p>
      </div>
    </div>

    <!-- ë‚´ ë°­ -->
    <div class="border-t pt-4">
      <h2 class="text-2xl font-bold text-center text-green-700 mb-4">ğŸ§‘â€ğŸŒ¾ ë‚´ ë°­</h2>
      <div class="flex gap-3">
        <button onclick="plantCrop('potato')" class="flex-1 bg-green-400 text-white py-2 rounded-xl hover:bg-green-500 transition">ğŸ¥” ì”¨ê°ì ì‹¬ê¸°</button>
        <button onclick="plantCrop('barley')" class="flex-1 bg-yellow-400 text-white py-2 rounded-xl hover:bg-yellow-500 transition">ğŸŒ¾ ë³´ë¦¬ì”¨ ì‹¬ê¸°</button>
      </div>
      <div class="mt-3 text-sm text-gray-600">
        <p id="field-status">ë°­ ìƒíƒœ: ë¡œë”©ì¤‘...</p>
      </div>
      <div class="flex justify-center mt-4">
        <button onclick="harvestCrop()" class="bg-orange-500 text-white px-4 py-2 rounded-xl hover:bg-orange-600 transition">
          ğŸŒ¾ ìˆ˜í™•í•˜ê¸°
        </button>
      </div>
    </div>

  </div>

  <script>
    const USER_ID = 'USER123';

    async function buySeed(type) {
      const res = await fetch(`/farm/buy_seed`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: USER_ID, seed_type: type })
      });
      const data = await res.json();
      alert(data.message || 'êµ¬ë§¤ ì™„ë£Œ!');
      updateInventory();
    }

    async function plantCrop(type) {
      const res = await fetch(`/farm/plant`, {
        method: 'POST',
        headers: { 'Content-type': 'application/json' },
        body: JSON.stringify({ user_id: USER_ID, crop_type: type })
      });
      const data = await res.json();
      alert(data.message || 'ì‹¬ê¸° ì™„ë£Œ!');
      updateInventory();
      updateFieldStatus();
    }

    async function harvestCrop() {
      const res = await fetch(`/farm/harvest`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: USER_ID })
      });
      const data = await res.json();
      alert(data.message || 'ìˆ˜í™• ì™„ë£Œ!');
      updateInventory();
      updateFieldStatus();
    }

    async function updateInventory() {
      const res = await fetch(`/user/${USER_ID}`);
      const data = await res.json();
      document.getElementById("user-tokens").innerText = `ë³´ìœ  í† í°: ${data.token}`;
      document.getElementById("inventory-status").innerText =
        `ì”¨ê°ì: ${data.inventory.potato_seed || 0}, ë³´ë¦¬ì”¨: ${data.inventory.barley_seed || 0}`;
    }

    async function updateFieldStatus() {
      const res = await fetch(`/user/${USER_ID}`);
      const data = await res.json();
      const field = data.field || {};
      if (field.crop) {
        document.getElementById("field-status").innerText =
          `ì‹¬ì€ ì‘ë¬¼: ${field.crop} (ì‹œê°„: ${new Date(field.planted_at).toLocaleString()})`;
      } else {
        document.getElementById("field-status").innerText = "ë°­ ìƒíƒœ: ë¹„ì–´ ìˆìŒ";
      }
    }

    updateInventory();
    updateFieldStatus();
  </script>
</body>
</html>
