<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸŒ° OrcaX ìƒ‰ê¹”íŒ ë£°ë ›</title>
  <style>
    body {
      background-color: #0A0A1A;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 20px;
    }
    #wheel-container {
      position: relative;
      margin: 30px auto;
      width: 300px;
      height: 300px;
    }
    #pointer {
      width: 0;
      height: 0;
      border-left: 30px solid red;
      border-top: 15px solid transparent;
      border-bottom: 15px solid transparent;
      position: absolute;
      left: -30px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 10;
    }
    #wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 8px solid gold;
      background: conic-gradient(
        yellow 0deg 72deg,
        deepskyblue 72deg 144deg,
        black 144deg 216deg,
        orange 216deg 288deg,
        red 288deg 360deg
      );
      position: absolute;
      top: 0;
      left: 0;
      transition: transform 4s cubic-bezier(0.33, 1, 0.68, 1);
    }
    #result, #total, #emailGuide, #colorGuide {
      margin-top: 20px;
    }
    #spinBtn {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 1rem;
      background-color: #00cfff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #emailGuide, #colorGuide {
      font-size: 0.95rem;
      line-height: 1.6;
    }
    #emailGuide strong {
      color: #ffff00;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ° OrcaX ìƒ‰ê¹”íŒ ë£°ë ›</h1>

  <div id="wheel-container">
    <div id="pointer"></div>
    <div id="wheel"></div>
  </div>

  <button id="spinBtn">ëŒë¦¬ê¸° (<span id="spinCount">0</span>/5)</button>
  <div id="result">ğŸ¯ ê²°ê³¼: ì—†ìŒ</div>
  <div id="total">ğŸ’° ì´ì : 0 ORCX</div>

  <p id="emailGuide">
    ğŸ“¢ ëˆ„ì  ì ìˆ˜ 50000 ORCX ì´ìƒì´ë©´ ì•„ë˜ ì´ë©”ì¼ë¡œ ì‹ ì²­í•˜ì„¸ìš”!<br>
    ì‹ ì²­ ì´ë©”ì¼: <strong>jbl01570@hanmail.net</strong><br>
    (ë©”ì¼ ë³´ë‚¼ ë•Œ <u>ì§€ê°‘ì£¼ì†Œì™€ ì´ ì ìˆ˜</u>ë¥¼ í•¨ê»˜ ë³´ë‚´ì£¼ì„¸ìš”!)
  </p>

  <p id="colorGuide">
    ğŸ¯ ìƒ‰ê¹”ë³„ ì ìˆ˜ ì•ˆë‚´<br><br>
    <span style="color:yellow">ğŸŸ¡ ë…¸ë‘ìƒ‰: 200 ORCX</span><br>
    <span style="color:deepskyblue">ğŸŸ¦ íŒŒë€ìƒ‰: 300 ORCX</span><br>
    <span style="color:black">âš« ê²€ì •ìƒ‰: 0 (ê½)</span><br>
    <span style="color:orange">ğŸŸ§ ì£¼í™©ìƒ‰: 0 (ê½)</span><br>
    <span style="color:red">ğŸ”´ ë¹¨ê°•ìƒ‰: 100 ORCX</span>
  </p>

  <script>
    const spinBtn = document.getElementById('spinBtn');
    const resultDiv = document.getElementById('result');
    const totalDiv = document.getElementById('total');
    const spinCountSpan = document.getElementById('spinCount');
    const wheel = document.getElementById('wheel');

    let currentRotation = 0;
    let spinCount = 0;
    let totalScore = 0;
    let sessionScore = 0;
    const maxSpins = 5;

    async function fetchTotalScore() {
      const userWallet = localStorage.getItem("orcax_user") || "guest";
      try {
        const response = await fetch(`https://orcax-roulette-backend.onrender.com/api/roulette/score?user=${userWallet}`);
        const data = await response.json();
        return data.totalScore || 0;
      } catch {
        return 0;
      }
    }

    async function saveSessionScore() {
      const userWallet = localStorage.getItem("orcax_user") || "guest";
      if (sessionScore > 0) {
        await fetch(`https://orcax-roulette-backend.onrender.com/api/roulette/addscore`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user: userWallet,
            addedScore: sessionScore
          })
        });
      }
    }

    function updateUI() {
      spinCountSpan.innerText = spinCount;
      totalDiv.innerHTML = `ğŸ’° ì´ì : ${totalScore} ORCX`;
    }

    function doSpin() {
      if (spinCount >= maxSpins) {
        alert("ë” ì´ìƒ ëŒë¦´ ìˆ˜ ì—†ì–´ìš”!");
        return;
      }

      spinCount++;
      updateUI();

      const randomExtraRotation = Math.floor(Math.random() * 360);
      const spinDeg = (360 * 5) + randomExtraRotation;
      currentRotation += spinDeg;

      wheel.style.transform = `rotate(-${currentRotation}deg)`;

      setTimeout(() => {
        const normalizedRotation = (currentRotation % 360 + 360) % 360;
        const pointerDeg = (normalizedRotation + 270) % 360; // âœ… ì •í™•í•œ ë°©í–¥ ë³´ì •

        let reward = 0;
        let label = '';

        if (pointerDeg >= 0 && pointerDeg < 72) {
          reward = 200; label = 'ë…¸ë‘ìƒ‰';
        } else if (pointerDeg >= 72 && pointerDeg < 144) {
          reward = 300; label = 'íŒŒë€ìƒ‰';
        } else if (pointerDeg >= 144 && pointerDeg < 216) {
          reward = 0; label = 'ê²€ì •ìƒ‰';
        } else if (pointerDeg >= 216 && pointerDeg < 288) {
          reward = 0; label = 'ì£¼í™©ìƒ‰';
        } else {
          reward = 100; label = 'ë¹¨ê°•ìƒ‰';
        }

        resultDiv.innerHTML = `ğŸ¯ ê²°ê³¼: ${label} (${reward > 0 ? reward + ' ORCX' : 'ê½'})`;
        totalScore += reward;
        sessionScore += reward;
        updateUI();

        if (spinCount === maxSpins) {
          saveSessionScore();
        }
      }, 4200);
    }

    spinBtn.addEventListener('click', doSpin);

    (async function init() {
      totalScore = await fetchTotalScore();
      updateUI();
    })();
  </script>
</body>
</html>
